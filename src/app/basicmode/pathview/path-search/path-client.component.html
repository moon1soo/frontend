<h3 class="title-grid-sub mb-5">
    {{'renewal2017.selectResult' | translate}}
</h3>
<div>
<form [formGroup]="clientForm">

<ngb-accordion #accPath="ngbAccordion"
    [closeOthers]="true"
    (panelChange)="beforeChange($event)"
    activeIds="pathPanel-0"
    class="select-accordian col-sm-4 float-left">   
    <div *ngFor="let client of clientWordIdx.idx; let idx = index">
        <ngb-panel id="pathPanel-{{idx}}">
            <ng-template ngbPanelTitle>
                <div class="float-left floating-btn-group">
                    <!-- <div class="btn-group mr-4" role="group" aria-label="Basic example" *ngIf="client.length">
                        <button type="button" 
                            class="btn btn-xs" 
                            [ngClass]="{'btn-info': condition[idx] === 'and', 'btn-light': condition[idx] === 'not'}"
                            (click)="activeBtn($event, idx, 'and')">
                            {{'renewal2017.inclusion' | translate}}
                        </button>
                        <button type="button" 
                            class="btn btn-xs btn-light" 
                            [ngClass]="{'btn-info': condition[idx] === 'not', 'btn-light': condition[idx] === 'and'}"
                            (click)="activeBtn($event, idx, 'not')">
                            {{'renewal2017.exclusion' | translate}}
                        </button>
                    </div> -->
                   <!-- <small>{{dataSour.length ? client.length : '0'}} {{'renewal2017.selectEa' | translate}}
                   </small>  -->          
                    <span class="input-material client ml-3" *ngIf="(client != null) && condition[idx] != null" (click)="inputFocus($event)">
                        <input type="text"
                            placeholder="{{'renewal2017.placeholder.index' | translate}}" 
                            formControlName="word-index-{{clientWordIdx.idx[idx]}}"
                            [(ngModel)]="clientWordIdx.index[idx]"
                            (ngModelChange)="activeWordIndex($event, idx)">                             
                        <i class="fal fa-pencil" aria-hidden="true" (mousedown)="inputFocus($event)"></i>
                    </span>  
                </div>
                <div class="float-right">
                    <button type="button" class="btn btn-collapse" ngbTooltip="{{'renewal2017.pathology.else' | translate}}" (click)="deleteClient($event, idx)">
                        <i class="fal fa-times" aria-hidden="true"></i>
                        <span class="sr-only">{{'research.all.delete' | translate}}</span>
                    </button>
                    <button type="button" class="btn btn-collapse">
                        <i class="fal fa-chevron-up" aria-hidden="true" [ngClass]="{'fa-rotate-180' : activeId !== 'PathPanel-{idx}'}"></i>
                        <span class="sr-only">{{'renewal2017.collapse' | translate}}</span>
                    </button>                     
                </div>      
            </ng-template>
            <ng-template ngbPanelContent>
                <dx-data-grid   
                    class="gridSelect"                  
                    [dataSource]="dataSource[idx]"
                    (onSelectionChanged)="onSelectionChanged($event)"
                    (onContentReady)="onContentReady($event)">
                    <dxi-column dataField="plrtLdatKey" caption="{{'renewal2017.pathology.else' | translate}}"></dxi-column>
                    <dxi-column  [width]="50"
                        [allowFiltering]="false"
                        [allowSorting]="false"
                        cellTemplate="cellTemplate">
                    </dxi-column>
                   
                    <dxo-scrolling mode="virtual"></dxo-scrolling>
                    <dxo-sorting mode="single"></dxo-sorting>
                    <div *dxTemplate="let data of 'cellTemplate'">
                        <button type="button" class="btn btn-text-type" title="close" (click)="onDeleteRow(data)">
                            <i class="fal fa-times-circle" aria-hidden="true"></i>
                            <span class="sr-only">close</span>
                        </button>
                    </div>
                </dx-data-grid>
            </ng-template>
        </ngb-panel>
    </div>
</ngb-accordion>
 <!-- VALUE SELECT -->
    <div *ngFor="let client of clientWordIdx.idx; let grp = index">
        <ngb-panel id="pathPanel-{{grp}}">
                <div *ngFor="let cont of clientValIdx.idx; let idx = index">
                    <!-- and, or, not button (default : and) -->
                    <select
                            *ngIf="(grp === clientValIdx.grp[idx]) && (clientValIdx.idx[idx] !== 0)"
                            class="form-control float-left mr-1 custom-select select-condition"
                            title="select condition"
                            formControlName="freeTextCondition-{{clientValIdx.grp[idx]}}-{{clientValIdx.idx[idx]}}"
                            style="height: 50px; margin-bottom: 15px;"
                            [(ngModel)]="clientValIdx.freeTextCondition[idx]">
                            <option value="and" selected>and</option>
                            <option value="or">or</option>
                            <option value="not">not</option>
                    </select>

                    <!-- TextField (freeText) -->
                    <input
                        *ngIf="grp === clientValIdx.grp[idx]"
                        type="text"
                        class="form-control input-date-sm float-left mr-1"
                        title="Free Text"
                        formControlName="freeText-{{clientValIdx.grp[idx]}}-{{clientValIdx.idx[idx]}}"
                        [value]="clientValIdx.freeText[idx]"
                        style="width: 160px; height: 50px; margin-bottom: 15px;" />
                   
                    <!-- add value(row) -->   
                    <button *ngIf="valueCount.idx[grp] === clientValIdx.idx[idx] && grp === clientValIdx.grp[idx]"
                            type="button"
                            class="btn btn-md btn-secondary"
                            style="height: 50px; margin-bottom: 15px;"
                            (click)="addValue(grp)"
                            [disabled]="valueCount.idx[grp] === 2" >
                        <i class="fal fa-plus" aria-hidden="true"></i>
                        <span class="sr-only">{{'research.add' | translate}}</span>
                    </button>

                    <!-- delete value(row) -->
                    <button *ngIf="valueCount.idx[grp] === clientValIdx.idx[idx] && grp === clientValIdx.grp[idx]"
                            type="button"
                            class="btn btn-md btn-secondary"
                            style="height: 50px; margin-bottom: 15px;"
                            (click)="delValue(grp)"
                            [disabled]="valueCount.idx[grp] === 0" >
                        <i class="fal fa-minus" aria-hidden="true"></i>
                        <span class="sr-only">{{'research.delete' | translate}}</span>
                    </button>
                    
                </div>
            
        </ngb-panel>
      
    </div>
</form>
</div>

<button type="button" class="btn btn-add-grid btn-secondary" title="Add Grid" (click)="addGrid($event)" style="margin-left: 15px; margin-right: 5px;"> 
    <i class="fal fa-plus-circle fa-inverse" aria-hidden="true"></i>
    <div class="sr-only">Add Grid</div>
</button>
